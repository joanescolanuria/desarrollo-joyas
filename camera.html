<!DOCTYPE html>
<html>

<head>
  <!-- Basic -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Mobile Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- Site Metas -->
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta name="author" content="" />

  <title>Lodge</title>

  <!-- slider stylesheet -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.1.3/assets/owl.carousel.min.css" />

  <!-- bootstrap core css -->
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />

  <!-- fonts style -->
  <link href="https://fonts.googleapis.com/css?family=Baloo+Chettan|Poppins:400,600,700&display=swap" rel="stylesheet">
  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet" />
  <!-- responsive style -->
  <link href="css/responsive.css" rel="stylesheet" />
  <style>
    .item_container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
    }

    .box {
      flex: 1 1 calc(33.333% - 20px); /* Ocupa un tercio del ancho del contenedor con espacio */
      box-sizing: border-box;
      padding: 10px;
      min-width: 100px; /* Asegura un tamaño mínimo para mantener la alineación */
    }

    .img-box img {
      width: 100%;
      height: auto;
    }

    @media (max-width: 600px) {
      .box {
        flex: 1 1 calc(33.333% - 10px); /* Ajuste para pantallas pequeñas */
      }
    }
    
    video, canvas {
      display: block;
      margin: auto;
    }
    .joya-img {
      width: 100px;
      cursor: pointer;
      margin: 10px;
    }
    .joyas-container {
      text-align: center;
    }
  </style>
</head>

<body class="sub_page">

  <div class="hero_area">
    <!-- header section strats -->
    <header class="header_section">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-lg custom_nav-container ">
          <a class="navbar-brand" href="index.html">
            <img src="images/logo.png" alt="">
            <span>
              Ana 
            </span>
          </a>
     
        </nav>
      </div>
    </header>
    <!-- end header section -->
  </div>

  <!-- AQUI TIENE QUE IR LA CAMARA EN ESTA PAGINA --->
  <h1>Prueba</h1>
  <video id="video" width="640" height="480" autoplay playsinline></video>
  <canvas id="canvas" width="640" height="480"></canvas>
  
  <div class="joyas-container">
    <img src="imagen.png" class="joya-img" id="joya1" alt="Joya 1">
    <img src="imagen3.png" class="joya-img" id="joya2" alt="Joya 2">
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
  <script>
    let video = document.getElementById('video');
    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    let joyaImage = new Image();
    let selectedJoya = '';

    async function setupCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: 'user'
          }
        });
        video.srcObject = stream;
        return new Promise((resolve) => {
          video.onloadedmetadata = () => {
            resolve(video);
          };
        });
      } catch (error) {
        console.error('Error accediendo a la cámara: ', error);
      }
    }

    async function loadBlazePose() {
      try {
        const model = await poseDetection.createDetector(poseDetection.SupportedModels.BlazePose, {
          runtime: 'tfjs',
          modelType: 'full'
        });
        return model;
      } catch (error) {
        console.error('Error cargando el modelo BlazePose: ', error);
      }
    }

    function getJoyaPosition(pose) {
      if (!pose || !pose.keypoints) {
        return null;
      }

      const nose = pose.keypoints.find(point => point.name === 'nose');
      const leftShoulder = pose.keypoints.find(point => point.part === 'left_shoulder');
      const rightShoulder = pose.keypoints.find(point => point.part === 'right_shoulder');

      if (nose && leftShoulder && rightShoulder) {
        const x = nose.x;
        const y = (leftShoulder.y + rightShoulder.y) / 2;
        return { x, y, leftShoulder, rightShoulder };
      }
      return null;
    }

    async function startApp() {
      await setupCamera();
      const net = await loadBlazePose();

      if (!net) {
        console.error('No se pudo cargar el modelo BlazePose');
        return;
      }

      video.play();

      async function detectPose() {
        try {
          const poses = await net.estimatePoses(video, {
            flipHorizontal: false,
            decodingMethod: 'single-person'
          });

          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

          if (poses.length > 0) {
            const pose = poses[0];
            const joyaPosition = getJoyaPosition(pose);

            if (joyaPosition && selectedJoya) {
              const { leftShoulder, rightShoulder } = joyaPosition;
              const neckWidth = Math.abs(leftShoulder.x - rightShoulder.x);
              const scale = neckWidth / joyaImage.width;

              ctx.save();
              ctx.translate(joyaPosition.x, joyaPosition.y);
              ctx.scale(scale, scale);
              ctx.drawImage(joyaImage, -joyaImage.width / 2, 0);
              ctx.restore();
            }
          }
        } catch (error) {
          console.error('Error al detectar la pose: ', error);
        }

        requestAnimationFrame(detectPose);
      }

      detectPose();
    }

    document.getElementById('joya1').addEventListener('click', () => {
      selectedJoya = 'imagen.png';
      joyaImage.src = selectedJoya;
      console.log('Joya 1 seleccionada');
    });

    document.getElementById('joya2').addEventListener('click', () => {
      selectedJoya = 'imagen3.png';
      joyaImage.src = selectedJoya;
      console.log('Joya 2 seleccionada');
    });

    joyaImage.onload = () => {
      console.log('Imagen de joya cargada: ', selectedJoya);
    };

    joyaImage.onerror = (error) => {
      console.error('Error cargando la imagen de joya: ', error);
    };

    startApp();
  </script>

  <!-- item section -->
  <div class="item_section layout_padding2">
    <div class="container">
      <div class="item_container">
        <div class="box">
          <div class="price">
            <h6>en desarrollo</h6>
          </div>
          <div class="img-box">
            <img src="imagen.png" alt="">
          </div>
          <div class="name">
            <h5>Joya 01</h5>
          </div>
        </div>
        <div class="box">
          <div class="price">
            <h6>en desarrollo</h6>
          </div>
          <div class="img-box">
            <img src="imagen3.png" alt="">
          </div>
          <div class="name">
            <h5>Joya 02</h5>
          </div>
        </div>
       
      </div>
    </div>
  </div>

  <!-- end item section -->

  <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.js"></script>
  <script type="text/javascript" src="js/custom.js"></script>
</body>

</html> 
